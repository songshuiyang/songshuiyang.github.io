<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><title>接入微信扫码支付接口 | 宋水阳个人博客</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#3F51B5"><meta name="keywords" content="支付"><meta name="description" content="准备条件开始之前先看一下微信的几个平台: 微信公众平台:是微信公众账号申请入口和管理后台。商户可以在公众平台提交基本资料、业务资料、财务资料申请开通微信支付功能。平台入口：http://mp.weixin.qq.com。 微信开放平台:微信开放平台是商户APP接入微信支付开放接口的申请入口，通过此平台可申请微信APP支付。平台入口：http://open.weixin.qq.com。 微信商户平台"><meta name="keywords" content="支付"><meta property="og:type" content="article"><meta property="og:title" content="接入微信扫码支付接口"><meta property="og:url" content="http://www.songshuiyang.site/2018/01/11/backend/支付/接入微信支付接口/index.html"><meta property="og:site_name" content="宋水阳个人博客"><meta property="og:description" content="准备条件开始之前先看一下微信的几个平台: 微信公众平台:是微信公众账号申请入口和管理后台。商户可以在公众平台提交基本资料、业务资料、财务资料申请开通微信支付功能。平台入口：http://mp.weixin.qq.com。 微信开放平台:微信开放平台是商户APP接入微信支付开放接口的申请入口，通过此平台可申请微信APP支付。平台入口：http://open.weixin.qq.com。 微信商户平台"><meta property="og:locale" content="default"><meta property="og:image" content="http://www.songshuiyang.site/images/server/支付/weixin.png"><meta property="og:updated_time" content="2018-02-26T12:31:59.709Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="接入微信扫码支付接口"><meta name="twitter:description" content="准备条件开始之前先看一下微信的几个平台: 微信公众平台:是微信公众账号申请入口和管理后台。商户可以在公众平台提交基本资料、业务资料、财务资料申请开通微信支付功能。平台入口：http://mp.weixin.qq.com。 微信开放平台:微信开放平台是商户APP接入微信支付开放接口的申请入口，通过此平台可申请微信APP支付。平台入口：http://open.weixin.qq.com。 微信商户平台"><meta name="twitter:image" content="http://www.songshuiyang.site/images/server/支付/weixin.png"><link rel="alternate" type="application/atom+xml" title="宋水阳个人博客" href="/atom.xml"><link rel="shortcut icon" href="/img/favicon.png"><link rel="stylesheet" href="/css/style.css?v=1.7.2"><script>window.lazyScripts=[]</script></head><body><div id="loading" class="active"></div><aside id="menu"><div class="inner flex-row-vertical"><a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off"><i class="icon icon-lg icon-close"></i></a><div class="brand-wrap" style="background-image:url(/img/brand.jpg)"><div class="brand"> <a href="/" class="avatar waves-effect waves-circle waves-light"><img src="/img/avatar.jpg"></a><hgroup class="introduce"><h5 class="nickname">songshuiyang</h5> <a href="mailto:songshuiyang@foxmail.com" title="songshuiyang@foxmail.com" class="mail">songshuiyang@foxmail.com</a></hgroup></div></div><div class="scroll-wrap flex-col"><ul class="nav"><li class="waves-block waves-effect"><a href="/"><i class="icon icon-lg icon-home"></i> 主页</a></li><li class="waves-block waves-effect"><a href="/archives"><i class="icon icon-lg icon-archives"></i> 归档</a></li><li class="waves-block waves-effect"><a href="/categories"><i class="icon icon-lg icon-th-list"></i> 分类</a></li><li class="waves-block waves-effect"><a href="/tags"><i class="icon icon-lg icon-tags"></i> 标签</a></li><li class="waves-block waves-effect"><a href="https://github.com/songshuiyang" target="_blank"><i class="icon icon-lg icon-github"></i> Github</a></li></ul></div></div></aside><main id="main"><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?ac93934d9b847216e10a2f133187e535";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><header class="top-header" id="header"><div class="flex-row"><a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle"><i class="icon icon-lg icon-navicon"></i></a><div class="flex-col header-title ellipsis">接入微信扫码支付接口</div><div class="search-wrap" id="search-wrap"><a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back"><i class="icon icon-lg icon-chevron-left"></i></a> <input type="text" id="key" class="search-input" autocomplete="off" placeholder=""><a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search"><i class="icon icon-lg icon-search"></i></a></div><a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare"><i class="icon icon-lg icon-share-alt"></i></a></div></header><header class="content-header post-header"><div class="container fade-scale"><h1 class="title">接入微信扫码支付接口</h1><h5 class="subtitle"> <time datetime="2018-01-11T13:24:12.000Z" itemprop="datePublished" class="page-time">2018-01-11</time><ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/server/">server</a></li></ul></h5></div></header><div class="container body-wrap"><aside class="post-widget"><nav class="post-toc-wrap post-toc-shrink" id="post-toc"><h4>TOC</h4><ol class="post-toc"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#准备条件"><span class="post-toc-number">1.</span> <span class="post-toc-text">准备条件</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#开始之前先看一下微信的几个平台"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">开始之前先看一下微信的几个平台:</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#开通支付功能"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">开通支付功能:</span></a></li></ol></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#微信支付开发"><span class="post-toc-number">2.</span> <span class="post-toc-text">微信支付开发:</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#接入微信支付步骤"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">接入微信支付步骤</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-6"><a class="post-toc-link" href="#1-获取支付SDK"><span class="post-toc-number">2.1.1.</span> <span class="post-toc-text">1. 获取支付SDK</span></a></li><li class="post-toc-item post-toc-level-6"><a class="post-toc-link" href="#2-配置参数"><span class="post-toc-number">2.1.2.</span> <span class="post-toc-text">2. 配置参数</span></a></li><li class="post-toc-item post-toc-level-6"><a class="post-toc-link" href="#3-新建一个参数配置类"><span class="post-toc-number">2.1.3.</span> <span class="post-toc-text">3. 新建一个参数配置类</span></a></li><li class="post-toc-item post-toc-level-6"><a class="post-toc-link" href="#4-new-一个WXPay对象"><span class="post-toc-number">2.1.4.</span> <span class="post-toc-text">4. new 一个WXPay对象</span></a></li><li class="post-toc-item post-toc-level-6"><a class="post-toc-link" href="#5-有了”对象”之后就可以发送支付请求了"><span class="post-toc-number">2.1.5.</span> <span class="post-toc-text">5. 有了”对象”之后就可以发送支付请求了</span></a></li><li class="post-toc-item post-toc-level-6"><a class="post-toc-link" href="#6-生成支付二维码"><span class="post-toc-number">2.1.6.</span> <span class="post-toc-text">6. 生成支付二维码</span></a></li><li class="post-toc-item post-toc-level-6"><a class="post-toc-link" href="#7-支付完成-处理异步回调"><span class="post-toc-number">2.1.7.</span> <span class="post-toc-text">7. 支付完成, 处理异步回调</span></a></li><li class="post-toc-item post-toc-level-6"><a class="post-toc-link" href="#备注：-微信支付是使用的xml进行传输数据，需要将xml转成map，当然微信SDK中也提供了工具类，提供了一些十分用的方法"><span class="post-toc-number">2.1.8.</span> <span class="post-toc-text">备注： 微信支付是使用的xml进行传输数据，需要将xml转成map，当然微信SDK中也提供了工具类，提供了一些十分用的方法</span></a></li></ol></li></ol></li></ol></nav></aside><article id="post-backend/支付/接入微信支付接口" class="post-article article-type-post fade" itemprop="blogPost"><div class="post-card"><h1 class="post-card-title">接入微信扫码支付接口</h1><div class="post-meta"> <time class="post-time" title="2018-01-11 21:24:12" datetime="2018-01-11T13:24:12.000Z" itemprop="datePublished">2018-01-11</time><ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/server/">server</a></li></ul><span id="busuanzi_container_site_pv"><i class="icon icon-eye icon-pr"></i> 本页总访问量<span id="busuanzi_value_page_pv"></span>次</span></div><div class="post-content" id="post-content" itemprop="postContent"><h4 id="准备条件"><a href="#准备条件" class="headerlink" title="准备条件"></a>准备条件</h4><h5 id="开始之前先看一下微信的几个平台"><a href="#开始之前先看一下微信的几个平台" class="headerlink" title="开始之前先看一下微信的几个平台:"></a>开始之前先看一下微信的几个平台:</h5><ol><li>微信公众平台:<br>是微信公众账号申请入口和管理后台。商户可以在公众平台提交基本资料、业务资料、财务资料申请开通微信支付功能。<br>平台入口：<a href="http://mp.weixin.qq.com。" target="_blank" rel="noopener">http://mp.weixin.qq.com。</a></li><li>微信开放平台:<br>微信开放平台是商户APP接入微信支付开放接口的申请入口，通过此平台可申请微信APP支付。<br>平台入口：<a href="http://open.weixin.qq.com。" target="_blank" rel="noopener">http://open.weixin.qq.com。</a></li><li>微信商户平台:<br>微信商户平台是微信支付相关的商户功能集合，包括参数配置、支付数据查询与统计、在线退款、代金券或立减优惠运营等功能。<br>平台入口：<a href="http://pay.weixin.qq.com" target="_blank" rel="noopener">http://pay.weixin.qq.com</a></li></ol><p>刚开始接入的时候有点昏，各种参数需要到不同的平台找, 不像支付宝一样只有一个开发平台，如果是接入微信扫码支付设及到微信公众平台和微信商户平台，如果是手机app微信支付，设及到微信开放平台和微信商户平台</p><h5 id="开通支付功能"><a href="#开通支付功能" class="headerlink" title="开通支付功能:"></a>开通支付功能:</h5><p>有了平台账号之后，然后就是开通支付功能，等待审核通过，当然审核过程有可能被退回，大多是描述信息或者经营类别与营业执照描述不一致<br><a id="more"></a></p><h4 id="微信支付开发"><a href="#微信支付开发" class="headerlink" title="微信支付开发:"></a>微信支付开发:</h4><blockquote><p>下面是微信支付的业务流程时序图, 可以看到与支付宝的支付流程主要流程是差不多的，只不过微信扫码可以在本系统完成支付，没有发生页面跳转，可以自己DIY支付页面，只要将支付链接生成二维码图片即可完成支付<br></p><figure class="image-bubble"><div class="img-lightbox"><div class="overlay"></div> <img src="/images/server/支付/weixin.png" alt="logo" title=""></div><div class="image-caption">logo</div></figure><p></p></blockquote><h5 id="接入微信支付步骤"><a href="#接入微信支付步骤" class="headerlink" title="接入微信支付步骤"></a>接入微信支付步骤</h5><h6 id="1-获取支付SDK"><a href="#1-获取支付SDK" class="headerlink" title="1. 获取支付SDK"></a>1. 获取支付SDK</h6><p> gradle:地址 <code>compile(&quot;com.github.wxpay:wxpay-sdk:0.0.3&quot;)</code></p><h6 id="2-配置参数"><a href="#2-配置参数" class="headerlink" title="2. 配置参数"></a>2. 配置参数</h6><p>主要是如下参数, 可以配置在一个属性文件中方面配置</p><p>1、APP ID ，应用ID（在公众平台–基本配置模块中）</p><p>2、APP Sercret ，应用秘钥（在公众平台–基本配置模块中）32位数字大小写字母</p><p>3、API Key，API的秘钥（在商户平台–API安全中设置）</p><p>4、mchID , 商户号（在公众平台—微信支付—商户信息）</p><p>5、order_api ， 统一下单API的接口</p><p>6、notify_url 交易成功回调的接口的URL</p><h6 id="3-新建一个参数配置类"><a href="#3-新建一个参数配置类" class="headerlink" title="3. 新建一个参数配置类"></a>3. 新建一个参数配置类</h6><blockquote><p>WxPcPayConfigImpl.java 继承 WXPayConfig.java</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 微信支付PC端 基础属性配置</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WxPcPayConfigImpl</span> <span class="keyword">implements</span> <span class="title">WXPayConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Logger logger = LoggerFactory.getLogger(<span class="keyword">this</span>.getClass());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 配置文件地址</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String FILE_NAME = <span class="string">"weixin_pc_pay.properties"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 服务号的应用ID</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String APP_ID;</span><br><span class="line">    <span class="comment">// 服务号的应用密钥</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String APP_SECRET;</span><br><span class="line">    <span class="comment">// 服务号的配置token</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String TOKEN;</span><br><span class="line">    <span class="comment">// 商户号</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String MCH_ID;</span><br><span class="line">    <span class="comment">// API密钥</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String API_KEY;</span><br><span class="line">    <span class="comment">// 签名加密方式</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String SIGN_TYPE;</span><br><span class="line">    <span class="comment">// 微信支付证书</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String CERT_PATH;</span><br><span class="line">    <span class="comment">// 异步回调地址</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String NOTIFY_URL;</span><br><span class="line">    <span class="comment">// 是否使用沙箱环境</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> IS_USE_SANDBOX;</span><br><span class="line">    <span class="comment">// 证书</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] certData;</span><br><span class="line">    <span class="comment">// INSTANCE</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> WxPcPayConfigImpl INSTANCE;</span><br><span class="line">    <span class="comment">// 配置对象</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Configuration configs;</span><br><span class="line">    <span class="comment">// 文件分隔符</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> String SF_FILE_SEPARATOR = System.getProperty(<span class="string">"file.separator"</span>);<span class="comment">//文件分隔符</span></span><br><span class="line">    <span class="comment">// 二维码图片宽度</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> QR_IMG_WIDTH = <span class="number">300</span>;</span><br><span class="line">    <span class="comment">// 二维码图片高度</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> QR_IMG_HEIGHT = <span class="number">300</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回配置文件实例</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> WxPcPayConfigImpl <span class="title">getInstance</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (INSTANCE == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (WxPcPayConfigImpl.class) &#123;</span><br><span class="line">                <span class="keyword">if</span> (INSTANCE == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    INSTANCE = <span class="keyword">new</span> WxPcPayConfigImpl();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 加载微信配置文件</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (configs != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            configs = <span class="keyword">new</span> PropertiesConfiguration(FILE_NAME);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ConfigurationException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (configs == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"读取配置文件错误"</span> + FILE_NAME);</span><br><span class="line">        &#125;</span><br><span class="line">        APP_ID = configs.getString(<span class="string">"appId"</span>);</span><br><span class="line">        APP_SECRET = configs.getString(<span class="string">"appSecret"</span>);</span><br><span class="line">        TOKEN = configs.getString(<span class="string">"token"</span>);</span><br><span class="line">        MCH_ID = configs.getString(<span class="string">"mchId"</span>);</span><br><span class="line">        API_KEY = configs.getString(<span class="string">"apiKey"</span>);</span><br><span class="line">        SIGN_TYPE = configs.getString(<span class="string">"signType"</span>);</span><br><span class="line">        CERT_PATH = configs.getString(<span class="string">"certPath"</span>);</span><br><span class="line">        IS_USE_SANDBOX = configs.getBoolean(<span class="string">"isUseSandbox"</span>);</span><br><span class="line">        NOTIFY_URL = configs.getString(<span class="string">"notifyUrl"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 加载证书</span></span><br><span class="line">        File file;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// file = new File(CERT_PATH);</span></span><br><span class="line">            Resource resource = <span class="keyword">new</span> ClassPathResource(CERT_PATH);</span><br><span class="line">            file = resource.getFile();</span><br><span class="line">            InputStream certStream = <span class="keyword">new</span> FileInputStream(file);</span><br><span class="line">            certData = <span class="keyword">new</span> <span class="keyword">byte</span>[(<span class="keyword">int</span>) file.length()];</span><br><span class="line">            certStream.read(certData);</span><br><span class="line">            certStream.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取 App ID</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> App ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getAppID</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> APP_ID;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取 Mch ID</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Mch ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getMchID</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> MCH_ID;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取 API 密钥</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> API密钥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getKey</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> API_KEY;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取商户证书内容</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 商户证书内容</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> InputStream <span class="title">getCertStream</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ByteArrayInputStream certBis;</span><br><span class="line">        certBis = <span class="keyword">new</span> ByteArrayInputStream(<span class="keyword">this</span>.certData);</span><br><span class="line">        <span class="keyword">return</span> certBis;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * HTTP(S) 连接超时时间，单位毫秒</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getHttpConnectTimeoutMs</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">8000</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * HTTP(S) 读数据超时时间，单位毫秒</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getHttpReadTimeoutMs</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">10000</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">byte</span>[] getCertData() &#123;</span><br><span class="line">        <span class="keyword">return</span> certData;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCertData</span><span class="params">(<span class="keyword">byte</span>[] certData)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.certData = certData;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h6 id="4-new-一个WXPay对象"><a href="#4-new-一个WXPay对象" class="headerlink" title="4. new 一个WXPay对象"></a>4. new 一个<code>WXPay</code>对象</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">WXPay wxAppPay;</span><br><span class="line">WxPcPayConfigImpl pcConfig = WxPcPayConfigImpl.getInstance();</span><br><span class="line">wxpay = <span class="keyword">new</span> WXPay(pcConfig, WXPayConstants.SignType.MD5, WxPcPayConfigImpl.IS_USE_SANDBOX);</span><br></pre></td></tr></table></figure><h6 id="5-有了”对象”之后就可以发送支付请求了"><a href="#5-有了”对象”之后就可以发送支付请求了" class="headerlink" title="5. 有了”对象”之后就可以发送支付请求了"></a>5. 有了”对象”之后就可以发送支付请求了</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * PC端微信支付请求</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> domainId 商户订单号取实体类id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> amount   充值金额</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 处理结果数据</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">weixinPay</span><span class="params">(String domainId, BigDecimal amount, HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">    Map&lt;String, Object&gt; resultMaps = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    resultMaps.put(<span class="string">"status"</span>, <span class="string">"success"</span>);</span><br><span class="line"></span><br><span class="line">    HashMap&lt;String, String&gt; data = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    String currentUserName = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">if</span> (AccountUtils.getCurrentUser() != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isNotBlank(AccountUtils.getCurrentUser().getFdNickName())) &#123;</span><br><span class="line">            currentUserName = AccountUtils.getCurrentUser().getFdNickName();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    String description = currentUserName + <span class="string">" 账户充值"</span>;</span><br><span class="line"></span><br><span class="line">    data.put(<span class="string">"body"</span>, description);                                  <span class="comment">// 商品描述</span></span><br><span class="line">    data.put(<span class="string">"out_trade_no"</span>, domainId);                             <span class="comment">// 商户订单号</span></span><br><span class="line">    data.put(<span class="string">"total_fee"</span>, AmountUtils.transAmountToCent(amount));   <span class="comment">// 总金额,单位为分</span></span><br><span class="line">    data.put(<span class="string">"spbill_create_ip"</span>, WxUtils.getRemoteIp(request));     <span class="comment">// 发起人IP地址</span></span><br><span class="line">    data.put(<span class="string">"notify_url"</span>, WxPcPayConfigImpl.NOTIFY_URL);           <span class="comment">// 异步通知地址</span></span><br><span class="line">    data.put(<span class="string">"trade_type"</span>, <span class="string">"NATIVE"</span>);                               <span class="comment">// 此处指定为扫码支付</span></span><br><span class="line">    data.put(<span class="string">"product_id"</span>, domainId);                               <span class="comment">// 商品ID,trade_type=NATIVE时（即扫码支付），此参数必传</span></span><br><span class="line"></span><br><span class="line">    Map&lt;String, String&gt; resultMap;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        resultMap = wxpay.unifiedOrder(data);</span><br><span class="line">        logger.info(<span class="string">"微信生成二维码返回xml 转成Json"</span> + JsonFormatUtil.formatJson(resultMap.toString()));</span><br><span class="line">        System.out.println(resultMap);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        logger.error(<span class="string">"微信支付处理异常"</span>);</span><br><span class="line">        resultMaps.put(<span class="string">"status"</span>, <span class="string">"failed"</span>);</span><br><span class="line">        <span class="keyword">return</span> resultMaps;</span><br><span class="line">    &#125;</span><br><span class="line">    String returnCode = resultMap.get(<span class="string">"return_code"</span>);</span><br><span class="line">    <span class="comment">// 返回结果</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="string">"SUCCESS"</span>.equals(returnCode)) &#123;</span><br><span class="line">        String resultCode = resultMap.get(<span class="string">"result_code"</span>);</span><br><span class="line">        <span class="comment">// 处理结果</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="string">"SUCCESS"</span>.equals(resultCode)) &#123;</span><br><span class="line">            logger.info(<span class="string">"订单号：&#123;&#125;生成微信支付码成功"</span>, domainId);</span><br><span class="line">            String urlCode = resultMap.get(<span class="string">"code_url"</span>);</span><br><span class="line">            <span class="comment">// 生成二维码</span></span><br><span class="line">            logger.info(<span class="string">""</span>);</span><br><span class="line">            <span class="comment">// WxUtils.encodeQRCode(urlCode,imgPath);</span></span><br><span class="line">            String imgBase64Str = WxUtils.encodeQRCodeBase64(urlCode);</span><br><span class="line">            <span class="comment">// 是否是微信支付</span></span><br><span class="line">            resultMaps.put(<span class="string">"id"</span>, domainId);</span><br><span class="line">            resultMaps.put(<span class="string">"isWxPay"</span>, <span class="keyword">true</span>);</span><br><span class="line">            resultMaps.put(<span class="string">"img"</span>, imgBase64Str);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            String errCodeDes = resultMap.get(<span class="string">"err_code_des"</span>);</span><br><span class="line">            logger.info(<span class="string">"订单号：&#123;&#125;生成微信支付码(系统)失败:&#123;&#125;"</span>, domainId, errCodeDes);</span><br><span class="line">            resultMaps.put(<span class="string">"status"</span>, <span class="string">"failed"</span>);</span><br><span class="line">            <span class="keyword">return</span> resultMaps;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        String returnMsg = resultMap.get(<span class="string">"return_msg"</span>);</span><br><span class="line">        logger.info(<span class="string">"(订单号：&#123;&#125;生成微信支付码(通信)失败:&#123;&#125;"</span>, domainId, returnMsg);</span><br><span class="line">        resultMaps.put(<span class="string">"status"</span>, <span class="string">"failed"</span>);</span><br><span class="line">        <span class="keyword">return</span> resultMaps;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> resultMaps;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>微信支付统一下单接口:<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 作用：统一下单&lt;br&gt;</span></span><br><span class="line"><span class="comment"> * 场景：公共号支付、扫码支付、APP支付</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> reqData 向wxpay post的请求数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> API返回数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Map&lt;String, String&gt; <span class="title">unifiedOrder</span><span class="params">(Map&lt;String, String&gt; reqData)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.unifiedOrder(reqData, config.getHttpConnectTimeoutMs(), <span class="keyword">this</span>.config.getHttpReadTimeoutMs());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h6 id="6-生成支付二维码"><a href="#6-生成支付二维码" class="headerlink" title="6. 生成支付二维码"></a>6. 生成支付二维码</h6><p>这里我是将二维码链接字符串转成字符流 然后生成Base64位的图片字符, 只要在<img src=""> 设置src属性值，就可以完成图片展示，不用考虑生成的图片放在那里</p><h6 id="7-支付完成-处理异步回调"><a href="#7-支付完成-处理异步回调" class="headerlink" title="7. 支付完成, 处理异步回调"></a>7. 支付完成, 处理异步回调</h6><h6 id="备注：-微信支付是使用的xml进行传输数据，需要将xml转成map，当然微信SDK中也提供了工具类，提供了一些十分用的方法"><a href="#备注：-微信支付是使用的xml进行传输数据，需要将xml转成map，当然微信SDK中也提供了工具类，提供了一些十分用的方法" class="headerlink" title="备注： 微信支付是使用的xml进行传输数据，需要将xml转成map，当然微信SDK中也提供了工具类，提供了一些十分用的方法"></a>备注： 微信支付是使用的xml进行传输数据，需要将xml转成map，当然微信SDK中也提供了工具类，提供了一些十分用的方法</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.github.wxpay.sdk;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.StringWriter;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.security.MessageDigest;</span><br><span class="line"><span class="keyword">import</span> org.w3c.dom.Node;</span><br><span class="line"><span class="keyword">import</span> org.w3c.dom.NodeList;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.crypto.Mac;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.SecretKeySpec;</span><br><span class="line"><span class="keyword">import</span> javax.xml.parsers.DocumentBuilder;</span><br><span class="line"><span class="keyword">import</span> javax.xml.parsers.DocumentBuilderFactory;</span><br><span class="line"><span class="keyword">import</span> javax.xml.transform.OutputKeys;</span><br><span class="line"><span class="keyword">import</span> javax.xml.transform.Transformer;</span><br><span class="line"><span class="keyword">import</span> javax.xml.transform.TransformerFactory;</span><br><span class="line"><span class="keyword">import</span> javax.xml.transform.dom.DOMSource;</span><br><span class="line"><span class="keyword">import</span> javax.xml.transform.stream.StreamResult;</span><br><span class="line"><span class="keyword">import</span> com.github.wxpay.sdk.WXPayConstants.SignType;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WXPayUtil</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * XML格式字符串转换为Map</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> strXML XML字符串</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> XML数据转换后的Map</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Map&lt;String, String&gt; <span class="title">xmlToMap</span><span class="params">(String strXML)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Map&lt;String, String&gt; data = <span class="keyword">new</span> HashMap&lt;String, String&gt;();</span><br><span class="line">        DocumentBuilderFactory documentBuilderFactory = DocumentBuilderFactory.newInstance();</span><br><span class="line">        DocumentBuilder documentBuilder= documentBuilderFactory.newDocumentBuilder();</span><br><span class="line">        InputStream stream = <span class="keyword">new</span> ByteArrayInputStream(strXML.getBytes(<span class="string">"UTF-8"</span>));</span><br><span class="line">        org.w3c.dom.Document doc = documentBuilder.parse(stream);</span><br><span class="line">        doc.getDocumentElement().normalize();</span><br><span class="line">        NodeList nodeList = doc.getDocumentElement().getChildNodes();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> idx=<span class="number">0</span>; idx&lt;nodeList.getLength(); ++idx) &#123;</span><br><span class="line">            Node node = nodeList.item(idx);</span><br><span class="line">            <span class="keyword">if</span> (node.getNodeType() == Node.ELEMENT_NODE) &#123;</span><br><span class="line">                org.w3c.dom.Element element = (org.w3c.dom.Element) node;</span><br><span class="line">                data.put(element.getNodeName(), element.getTextContent());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            stream.close();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将Map转换为XML格式的字符串</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> data Map类型数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> XML格式的字符串</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">mapToXml</span><span class="params">(Map&lt;String, String&gt; data)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        DocumentBuilderFactory documentBuilderFactory = DocumentBuilderFactory.newInstance();</span><br><span class="line">        DocumentBuilder documentBuilder= documentBuilderFactory.newDocumentBuilder();</span><br><span class="line">        org.w3c.dom.Document document = documentBuilder.newDocument();</span><br><span class="line">        org.w3c.dom.Element root = document.createElement(<span class="string">"xml"</span>);</span><br><span class="line">        document.appendChild(root);</span><br><span class="line">        <span class="keyword">for</span> (String key: data.keySet()) &#123;</span><br><span class="line">            String value = data.get(key);</span><br><span class="line">            <span class="keyword">if</span> (value == <span class="keyword">null</span>) &#123;</span><br><span class="line">                value = <span class="string">""</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            value = value.trim();</span><br><span class="line">            org.w3c.dom.Element filed = document.createElement(key);</span><br><span class="line">            filed.appendChild(document.createTextNode(value));</span><br><span class="line">            root.appendChild(filed);</span><br><span class="line">        &#125;</span><br><span class="line">        TransformerFactory tf = TransformerFactory.newInstance();</span><br><span class="line">        Transformer transformer = tf.newTransformer();</span><br><span class="line">        DOMSource source = <span class="keyword">new</span> DOMSource(document);</span><br><span class="line">        transformer.setOutputProperty(OutputKeys.ENCODING, <span class="string">"UTF-8"</span>);</span><br><span class="line">        transformer.setOutputProperty(OutputKeys.INDENT, <span class="string">"yes"</span>);</span><br><span class="line">        StringWriter writer = <span class="keyword">new</span> StringWriter();</span><br><span class="line">        StreamResult result = <span class="keyword">new</span> StreamResult(writer);</span><br><span class="line">        transformer.transform(source, result);</span><br><span class="line">        String output = writer.getBuffer().toString(); <span class="comment">//.replaceAll("\n|\r", "");</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            writer.close();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> output;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生成带有 sign 的 XML 格式字符串</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> data Map类型数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key API密钥</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 含有sign字段的XML</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">generateSignedXml</span><span class="params">(<span class="keyword">final</span> Map&lt;String, String&gt; data, String key)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> generateSignedXml(data, key, SignType.MD5);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生成带有 sign 的 XML 格式字符串</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> data Map类型数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key API密钥</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> signType 签名类型</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 含有sign字段的XML</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">generateSignedXml</span><span class="params">(<span class="keyword">final</span> Map&lt;String, String&gt; data, String key, SignType signType)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String sign = generateSignature(data, key, signType);</span><br><span class="line">        data.put(WXPayConstants.FIELD_SIGN, sign);</span><br><span class="line">        <span class="keyword">return</span> mapToXml(data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断签名是否正确</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> xmlStr XML格式数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key API密钥</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 签名是否正确</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isSignatureValid</span><span class="params">(String xmlStr, String key)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Map&lt;String, String&gt; data = xmlToMap(xmlStr);</span><br><span class="line">        <span class="keyword">if</span> (!data.containsKey(WXPayConstants.FIELD_SIGN) ) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        String sign = data.get(WXPayConstants.FIELD_SIGN);</span><br><span class="line">        <span class="keyword">return</span> generateSignature(data, key).equals(sign);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断签名是否正确，必须包含sign字段，否则返回false。使用MD5签名。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> data Map类型数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key API密钥</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 签名是否正确</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isSignatureValid</span><span class="params">(Map&lt;String, String&gt; data, String key)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> isSignatureValid(data, key, SignType.MD5);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断签名是否正确，必须包含sign字段，否则返回false。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> data Map类型数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key API密钥</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> signType 签名方式</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 签名是否正确</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isSignatureValid</span><span class="params">(Map&lt;String, String&gt; data, String key, SignType signType)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!data.containsKey(WXPayConstants.FIELD_SIGN) ) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        String sign = data.get(WXPayConstants.FIELD_SIGN);</span><br><span class="line">        <span class="keyword">return</span> generateSignature(data, key, signType).equals(sign);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生成签名</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> data 待签名数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key API密钥</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 签名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">generateSignature</span><span class="params">(<span class="keyword">final</span> Map&lt;String, String&gt; data, String key)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> generateSignature(data, key, SignType.MD5);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生成签名. 注意，若含有sign_type字段，必须和signType参数保持一致。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> data 待签名数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key API密钥</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> signType 签名方式</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 签名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">generateSignature</span><span class="params">(<span class="keyword">final</span> Map&lt;String, String&gt; data, String key, SignType signType)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Set&lt;String&gt; keySet = data.keySet();</span><br><span class="line">        String[] keyArray = keySet.toArray(<span class="keyword">new</span> String[keySet.size()]);</span><br><span class="line">        Arrays.sort(keyArray);</span><br><span class="line">        StringBuilder sb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        <span class="keyword">for</span> (String k : keyArray) &#123;</span><br><span class="line">            <span class="keyword">if</span> (k.equals(WXPayConstants.FIELD_SIGN)) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (data.get(k).trim().length() &gt; <span class="number">0</span>) <span class="comment">// 参数值为空，则不参与签名</span></span><br><span class="line">                sb.append(k).append(<span class="string">"="</span>).append(data.get(k).trim()).append(<span class="string">"&amp;"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        sb.append(<span class="string">"key="</span>).append(key);</span><br><span class="line">        <span class="keyword">if</span> (SignType.MD5.equals(signType)) &#123;</span><br><span class="line">            <span class="keyword">return</span> MD5(sb.toString()).toUpperCase();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (SignType.HMACSHA256.equals(signType)) &#123;</span><br><span class="line">            <span class="keyword">return</span> HMACSHA256(sb.toString(), key);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> Exception(String.format(<span class="string">"Invalid sign_type: %s"</span>, signType));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取随机字符串 Nonce Str</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> String 随机字符串</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">generateNonceStr</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> UUID.randomUUID().toString().replaceAll(<span class="string">"-"</span>, <span class="string">""</span>).substring(<span class="number">0</span>, <span class="number">32</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生成 MD5</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> data 待处理数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> MD5结果</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">MD5</span><span class="params">(String data)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        java.security.MessageDigest md = MessageDigest.getInstance(<span class="string">"MD5"</span>);</span><br><span class="line">        <span class="keyword">byte</span>[] array = md.digest(data.getBytes(<span class="string">"UTF-8"</span>));</span><br><span class="line">        StringBuilder sb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">byte</span> item : array) &#123;</span><br><span class="line">            sb.append(Integer.toHexString((item &amp; <span class="number">0xFF</span>) | <span class="number">0x100</span>).substring(<span class="number">1</span>, <span class="number">3</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sb.toString().toUpperCase();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生成 HMACSHA256</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> data 待处理数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 密钥</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 加密结果</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">HMACSHA256</span><span class="params">(String data, String key)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Mac sha256_HMAC = Mac.getInstance(<span class="string">"HmacSHA256"</span>);</span><br><span class="line">        SecretKeySpec secret_key = <span class="keyword">new</span> SecretKeySpec(key.getBytes(<span class="string">"UTF-8"</span>), <span class="string">"HmacSHA256"</span>);</span><br><span class="line">        sha256_HMAC.init(secret_key);</span><br><span class="line">        <span class="keyword">byte</span>[] array = sha256_HMAC.doFinal(data.getBytes(<span class="string">"UTF-8"</span>));</span><br><span class="line">        StringBuilder sb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">byte</span> item : array) &#123;</span><br><span class="line">            sb.append(Integer.toHexString((item &amp; <span class="number">0xFF</span>) | <span class="number">0x100</span>).substring(<span class="number">1</span>, <span class="number">3</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sb.toString().toUpperCase();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>参考于:<br><a href="http://mp.weixin.qq.com" target="_blank" rel="noopener">http://mp.weixin.qq.com</a></p><p><a href="http://open.weixin.qq.com" target="_blank" rel="noopener">http://open.weixin.qq.com</a></p><p><a href="http://pay.weixin.qq.com" target="_blank" rel="noopener">http://pay.weixin.qq.com</a></p></div><blockquote class="post-copyright"><footer> <a href="http://www.songshuiyang.site"><img src="/img/avatar.jpg" alt="songshuiyang"> songshuiyang</a></footer></blockquote><div class="post-footer"><ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/支付/">支付</a></li></ul><div class="page-share-wrap"><div class="page-share" id="pageShare"><ul class="reset share-icons"><li><a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://www.songshuiyang.site/2018/01/11/backend/支付/接入微信支付接口/&title=《接入微信扫码支付接口》 — 宋水阳个人博客&pic=http://www.songshuiyang.site/img/avatar.jpg" data-title="微博"><i class="icon icon-weibo"></i></a></li><li><a class="weixin share-sns wxFab" href="javascript:;" data-title="微信"><i class="icon icon-weixin"></i></a></li><li><a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://www.songshuiyang.site/2018/01/11/backend/支付/接入微信支付接口/&title=《接入微信扫码支付接口》 — 宋水阳个人博客&source=准备条件开始之前先看一下微信的几个平台:
微信公众平台:是微信公众账号申请入口和管理后台。商户可以在公众平台提交基本资料、业务资料、财务资料申请开通微信支..." data-title=" QQ"><i class="icon icon-qq"></i></a></li><li><a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://www.songshuiyang.site/2018/01/11/backend/支付/接入微信支付接口/" data-title=" Facebook"><i class="icon icon-facebook"></i></a></li><li><a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《接入微信扫码支付接口》 — 宋水阳个人博客&url=http://www.songshuiyang.site/2018/01/11/backend/支付/接入微信支付接口/&via=http://www.songshuiyang.site" data-title=" Twitter"><i class="icon icon-twitter"></i></a></li><li><a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://www.songshuiyang.site/2018/01/11/backend/支付/接入微信支付接口/" data-title=" Google+"><i class="icon icon-google-plus"></i></a></li></ul></div><a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle"><i class="icon icon-share-alt icon-lg"></i></a></div></div></div><nav class="post-nav flex-row flex-justify-between"><div class="waves-block waves-effect prev"><a href="/2018/01/11/backend/支付/接入银联支付接口/" id="post-prev" class="post-nav-link"><div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div><h4 class="title">接入银联支付接口</h4></a></div><div class="waves-block waves-effect next"><a href="/2018/01/10/backend/支付/接入支付宝支付接口/" id="post-next" class="post-nav-link"><div class="tips">Next<i class="icon icon-angle-right icon-lg icon-pl"></i></div><h4 class="title">接入支付宝支付接口</h4></a></div></nav><div class="comments vcomment" id="comments"></div><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine@latest/dist/Valine.min.js"></script><script>var GUEST_INFO=["nick","mail","link"],guest_info="nick,mail,link".split(",").filter(function(e){return-1<GUEST_INFO.indexOf(e)});new Valine({el:"#comments",notify:!1,verify:!1,appId:"tFSCtBMsjdDCJmCEKGvMlHLh-gzGzoHsz",appKey:"wDUxU3I7OcPPuDDwMSe5Ochu",avatar:"robohash",placeholder:"少侠不吐槽吐槽?",guest_info:0==guest_info.length?GUEST_INFO:guest_info,pageSize:"10"})</script></article></div><footer class="footer"><div class="bottom"><p><span>songshuiyang &copy; 2017 - 2019</span> <span><a href="http://www.miitbeian.gov.cn/" target="_blank">赣ICP备18001541号</a><br></span> <span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span> <span id="busuanzi_container_site_uv">本站访客数<span id="busuanzi_value_site_uv"></span>人次</span></p></div></footer></main><div class="mask" id="mask"></div><a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a><div class="global-share" id="globalShare"><ul class="reset share-icons"><li><a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://www.songshuiyang.site/2018/01/11/backend/支付/接入微信支付接口/&title=《接入微信扫码支付接口》 — 宋水阳个人博客&pic=http://www.songshuiyang.site/img/avatar.jpg" data-title="微博"><i class="icon icon-weibo"></i></a></li><li><a class="weixin share-sns wxFab" href="javascript:;" data-title="微信"><i class="icon icon-weixin"></i></a></li><li><a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://www.songshuiyang.site/2018/01/11/backend/支付/接入微信支付接口/&title=《接入微信扫码支付接口》 — 宋水阳个人博客&source=准备条件开始之前先看一下微信的几个平台:
微信公众平台:是微信公众账号申请入口和管理后台。商户可以在公众平台提交基本资料、业务资料、财务资料申请开通微信支..." data-title=" QQ"><i class="icon icon-qq"></i></a></li><li><a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://www.songshuiyang.site/2018/01/11/backend/支付/接入微信支付接口/" data-title=" Facebook"><i class="icon icon-facebook"></i></a></li><li><a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《接入微信扫码支付接口》 — 宋水阳个人博客&url=http://www.songshuiyang.site/2018/01/11/backend/支付/接入微信支付接口/&via=http://www.songshuiyang.site" data-title=" Twitter"><i class="icon icon-twitter"></i></a></li><li><a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://www.songshuiyang.site/2018/01/11/backend/支付/接入微信支付接口/" data-title=" Google+"><i class="icon icon-google-plus"></i></a></li></ul></div><div class="page-modal wx-share" id="wxShare"><a class="close" href="javascript:;"><i class="icon icon-close"></i></a><p>扫一扫，分享到微信</p> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACt0lEQVR42u3aQY7jMAwEwPz/07PXARYTd5NSkEP5tPA4kkoLmDSp1yu+ft5ev59pR9vcP3bh4eHhXV568uT73/41TnI/XzMeHh7ebd5fb9Tklf0ell/7IISHh4f3zbz3r+M2eMzWg4eHh/f9vPx7P9+CWTECDw8P7xt4sxJDvvSc8f5XF2steHh4eDEv7yJ9z7+v9Pfw8PDw1l31TaMrT503DbOHdeLh4eFd4LUv5TYVPluuHW40Hh4e3sd5bfuqLR/kL/185MO7hYeHh/ffO3PWABsmuKMGWLJ9r01cwsPDw4t57XL3xd8NNQlgwwMEeHh4eDEvSVX3TbLZk3nKHn0r4OHh4R3ibRpOm4ZWnky3a8PDw8P7DC8JEnlu3m7BJpUv0n08PDy8Q7z8cNWm9HDq0FVdNMHDw8O7xstT2Hb6vMTQhoHk8AEeHh7ePd4mRW4BeQiZNc8eDl3h4eHhrXmzptSsRJsHgzxIFBUXPDw8vKO8/PM+v98ermo3vSig4OHh4R3lJcXW2ZR5yyoPD21JFw8PD+8ebzb9prybBJJk3ofPADw8PLxrvPxwQJ4c58EmT9DbrcfDw8O7wZstdNOsykc4dmQBDw8P7yivbf/nzf7Nnc1xLjw8PLzP8NrXdHswqy06tAn0Q8TDw8PDO8qbNaVmB6fa3yYpflGMwMPDwzvEe2ggjRpXm3S5HeEhmOHh4eFd4OVDz6Zv2e0z71NwPDw8vBu8n/Lap7zD9n/yvzSLaXh4eHglL7/y4wIzWF7wnR1WwMPDwzvL2yyuTcQ3s+SNtCKxxsPDw1vwZsWItqiaN73assWVWgseHh7empenxfloyfj51qwCAx4eHt4FXhIS2oMCs7/moQUPDw/vHq8tE7TTDxcXbNnDaHh4eHgXeLPh2pbVpsSQF4VX/T08PDy8Z94/+I1zqEfbNAQAAAAASUVORK5CYII=" alt="微信分享二维码"></div><script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script><script>var BLOG={ROOT:"/",SHARE:!0,REWARD:!1};lazyScripts.push("//s95.cnzz.com/z_stat.php?id=1275444015&web_id=1275444015")</script><script src="/js/main.min.js?v=1.7.2"></script><div class="search-panel" id="search-panel"><ul class="search-result" id="search-result"></ul></div><template id="search-tpl"><li class="item"><a href="{path}" class="waves-block waves-effect"><div class="title ellipsis" title="{title}">{title}</div><div class="flex-row flex-middle"><div class="tags ellipsis"> {tags}</div> <time class="flex-col time">{date}</time></div></a></li></template><script src="/js/search.min.js?v=1.7.2" async></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>!function(){var t,e=document.title;document.addEventListener("visibilitychange",function(){document.hidden?(document.title="老铁为何离开了",clearTimeout(t)):(document.title="欢迎回来",t=setTimeout(function(){document.title=e},2e3))})}()</script></body></html><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?ac93934d9b847216e10a2f133187e535";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script>